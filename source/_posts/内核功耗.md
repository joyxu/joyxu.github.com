---
title: 内核功耗
author: Joy Xu
date: 2023-07-26 03:11:11
tags: [linux, 功耗]
---

## idle

CPU是用来计算的，如果CPU没事可干的话，Linux Kernel中称cpu这种状态为idle，而内核中的
cpuidle framework就是为了管理这种状态。

### idle进程

CPU任何时候都是要执行进程的，把idle做成进程就可以和内核中当前的任务调度系统很自然的链接起来。
系统初始化之后，就会把第一个init进程变为idle进程，并把优先级设置成最低。
当idle进程被调用的时候，说明cpu已经没事可干了。

### CPU idle

cpu core根据功耗有不同的状态，ACPI定义了processor state，称为c state。
功耗越低唤醒延时越大。C0代表运行态，C1、C2、CX是具体的硬件实现，数字越大，睡眠程度越深。

### ARM64 cpu idle

ARM上cpu idle最初是通过WFI和WFE指令来实现的。
但是随着对时延要求的提高，CX state的引入，多级idle就自然而然产生了。

## linux kernel cpuidle framework

内核中的cpuidle框架逻辑视图如下：

![cpuidle framework](/images/cpuidle_framework.gif)

开发视图如下:

![cpuidle framework](/images/cpuidle_framework_dev.png)

## 参考

* [cpuidle overview](https://www.cnblogs.com/lvzh/p/17072062.html)
* [Linux cpuidle framework(1)_概述和软件架构](http://www.wowotech.net/pm_subsystem/cpuidle_overview.html)
* [Linux Cpuidle介绍](https://blog.csdn.net/feelabclihu/article/details/125688355)
